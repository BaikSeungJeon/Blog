# 년, 월, 성별 별 상품 구매 회원 수 구하기

## 문제

https://school.programmers.co.kr/learn/courses/30/lessons/131532

## 코드

```sql
SELECT YEAR(O.SALES_DATE) AS YEAR, MONTH(O.SALES_DATE) AS MONTH, U.GENDER AS GENDER, COUNT(DISTINCT U.USER_ID) AS USERS
FROM USER_INFO U
INNER JOIN ONLINE_SALE O
ON U.USER_ID = O.USER_ID
WHERE GENDER IS NOT NULL
GROUP BY YEAR, MONTH, GENDER
ORDER BY YEAR, MONTH, GENDER
```

## 풀이

연, 월, 성별에 따라 집계해 유저 수를 출력하면 됩니다. 이때 문제에서 성별(GENDER)이 비어있으면 출력하지 말라 돼 있으므로 조건절을 추가해 GENDER가 NULL 값인 경우 제외해 줍니다.

첫 번째 시도는 다음처럼 작성해 통과하지 못 했습니다.

```sql
SELECT YEAR(O.SALES_DATE) AS YEAR, MONTH(O.SALES_DATE) AS MONTH, U.GENDER AS GENDER, COUNT(U.USER_ID) AS USERS
FROM USER_INFO U
INNER JOIN ONLINE_SALE O
ON U.USER_ID = O.USER_ID
WHERE GENDER IS NOT NULL
GROUP BY YEAR, MONTH, GENDER
ORDER BY YEAR, MONTH, GENDER
```

유저를 집계하는 과정에서 <code>DISTINCT</code>를 생략해 작성했기 때문인데요. ONLINE_SALE 테이블을 보면, 한 명의 유저가(USER_ID가 1이라 가정) 같은 월에 두 번 이상 구매했어도, 유저는 한 명으로 집계 되어야 하기 때문에 <code>DISTINCT</code>를 사용해 중복을 제거해 줘야 합니다.